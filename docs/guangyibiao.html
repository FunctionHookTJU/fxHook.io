<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿ä¹‰è¡¨å­˜å‚¨ç»“æ„å›¾ - å®‡ä½è§å‡½é’©</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/icons/favicon-16x16.png">
    <link rel="manifest" href="../site.webmanifest">
    <script src="../scripts/header.js" defer></script>
    <style>
        :root {
            --primary-color: #8527d2b2;
            --secondary-color: #f5f5f5eb;
            --text-color: #333;
            --light-text: #fff;
            --transition: all 0.3s ease;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --node-atom: #4CAF50;
            --node-list: #2196F3;
            --arrow-color: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--secondary-color);
            background-image: url('https://cdn.jsdelivr.net/gh/FunctionHookTJU/fxHook.io@master/assets/images/background4k.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(245, 245, 245, 0.29);
            z-index: -1;
        }

        .main-container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content-wrapper {
            display: flex;
            gap: 20px;
            padding: 30px;
            flex-wrap: wrap;
        }

        .left-panel {
            flex: 1;
            min-width: 400px;
        }

        .right-panel {
            flex: 1.5;
            min-width: 500px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            font-size: 1.3em;
        }

        .section h3 {
            color: #764ba2;
            margin: 15px 0 10px;
            font-size: 1.1em;
        }

        .section p, .section li {
            color: #555;
            line-height: 1.8;
        }

        .section ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .section li {
            margin: 8px 0;
        }

        /* èŠ‚ç‚¹ç»“æ„ç¤ºæ„å›¾ */
        .node-structure {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .node-demo {
            text-align: center;
        }

        .node-demo-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .node-box {
            display: flex;
            border: 2px solid #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .node-field {
            padding: 10px 15px;
            border-right: 1px solid #333;
            min-width: 50px;
            text-align: center;
            font-family: monospace;
            font-size: 14px;
        }

        .node-field:last-child {
            border-right: none;
        }

        .node-field.tag {
            background: #e3f2fd;
        }

        .node-field.atom {
            background: #e8f5e9;
        }

        .node-field.hp {
            background: #fff3e0;
        }

        .node-field.tp {
            background: #fce4ec;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Consolas', monospace;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .example-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .example-btn {
            padding: 6px 12px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 13px;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* æ¨¡å¼é€‰æ‹©å™¨ */
        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .mode-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .mode-option input[type="radio"]:checked + .mode-label {
            color: #667eea;
            font-weight: 600;
        }

        .mode-label {
            font-size: 14px;
            color: #333;
        }

        .mode-desc {
            font-size: 12px;
            color: #888;
        }

        /* SVGç”»å¸ƒ */
        .canvas-container {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            overflow: auto;
            min-height: 400px;
            position: relative;
        }

        #glCanvas {
            display: block;
            min-width: 100%;
            min-height: 400px;
        }

        /* è§£æç»“æœ */
        .parse-result {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* å›¾ä¾‹ */
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #333;
        }

        .legend-color.atom {
            background: var(--node-atom);
        }

        .legend-color.list {
            background: var(--node-list);
        }

        /* ä»£ç å— */
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .code-keyword {
            color: #66d9ef;
        }

        .code-type {
            color: #a6e22e;
        }

        .code-comment {
            color: #75715e;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .info-table th, .info-table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .info-table th {
            background: #667eea;
            color: white;
        }

        .info-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* é”™è¯¯æç¤º */
        .error-msg {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .error-msg.show {
            display: block;
        }

        /* é€‰ä¸­çš„æ¨¡å¼æ ·å¼ */
        .mode-option:has(input:checked) {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8ecff 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        /* å“åº”å¼ */
        @media (max-width: 900px) {
            .content-wrapper {
                flex-direction: column;
            }

            .left-panel, .right-panel {
                min-width: 100%;
            }

            .page-header h1 {
                font-size: 1.8em;
            }

            .mode-selector {
                flex-direction: column;
            }
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 1rem 0;
            margin-top: auto;
        }

        .footer-content {
            text-align: center;
        }

        .footer-links {
            margin-bottom: 1rem;
        }

        .footer-links a {
            color: var(--light-text);
            text-decoration: none;
            margin: 0 1rem;
            transition: opacity 0.3s;
        }

        .footer-links a:hover {
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- Header will be injected by header.js -->

    <div class="main-container">
        <div class="page-header">
            <h1>ğŸ“Š å¹¿ä¹‰è¡¨å­˜å‚¨ç»“æ„å›¾</h1>
            <p class="subtitle">Generalized List Storage Structure Visualization</p>
        </div>

        <div class="content-wrapper">
            <!-- å·¦ä¾§ï¼šç†è®ºè®²è§£ -->
            <div class="left-panel">
                <div class="section">
                    <h2>ğŸ“š ä»€ä¹ˆæ˜¯å¹¿ä¹‰è¡¨ï¼Ÿ</h2>
                    <p>å¹¿ä¹‰è¡¨ï¼ˆGeneralized Listï¼‰æ˜¯çº¿æ€§è¡¨çš„æ¨å¹¿ï¼Œæ˜¯ä¸€ç§é€’å½’çš„æ•°æ®ç»“æ„ã€‚</p>
                    <ul>
                        <li><strong>åŸå­ï¼ˆAtomï¼‰</strong>ï¼šä¸å¯å†åˆ†çš„å…ƒç´ ï¼Œå¦‚å­—æ¯ã€æ•°å­—</li>
                        <li><strong>å­è¡¨ï¼ˆSublistï¼‰</strong>ï¼šä½œä¸ºå…ƒç´ çš„å¹¿ä¹‰è¡¨ï¼Œå¯ä»¥åµŒå¥—</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>ä¾‹å¦‚ï¼š</strong></p>
                    <ul>
                        <li><code>A = ()</code> â€” ç©ºè¡¨</li>
                        <li><code>B = (a, b, c)</code> â€” åªå«åŸå­</li>
                        <li><code>C = (a, (b, c), d)</code> â€” å«å­è¡¨</li>
                        <li><code>D = ((a, b), (c, (d, e)))</code> â€” å¤šå±‚åµŒå¥—</li>
                    </ul>
                </div>

                <div class="section">
                    <h2>ğŸ”§ æ–¹å¼ä¸€ï¼šå¤´å°¾é“¾è¡¨æ³•</h2>
                    <p>åŸå­èŠ‚ç‚¹å’Œè¡¨èŠ‚ç‚¹<strong>ç»“æ„ç›¸åŒ</strong>ï¼Œéƒ½æœ‰ tp æŒ‡é’ˆï¼š</p>
                    
                    <div class="node-structure">
                        <div class="node-demo">
                            <div class="node-demo-title">åŸå­èŠ‚ç‚¹ (tag=0)</div>
                            <div class="node-box">
                                <div class="node-field tag">tag=0</div>
                                <div class="node-field atom">atom</div>
                                <div class="node-field tp">tp</div>
                            </div>
                        </div>
                        <div class="node-demo">
                            <div class="node-demo-title">è¡¨èŠ‚ç‚¹ (tag=1)</div>
                            <div class="node-box">
                                <div class="node-field tag">tag=1</div>
                                <div class="node-field hp">hp</div>
                                <div class="node-field tp">tp</div>
                            </div>
                        </div>
                    </div>

                    <table class="info-table">
                        <tr>
                            <th>å­—æ®µ</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td><strong>tag</strong></td>
                            <td>æ ‡å¿—ä½ï¼š0è¡¨ç¤ºåŸå­ï¼Œ1è¡¨ç¤ºå­è¡¨</td>
                        </tr>
                        <tr>
                            <td><strong>atom</strong></td>
                            <td>åŸå­èŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®å€¼</td>
                        </tr>
                        <tr>
                            <td><strong>hp</strong></td>
                            <td>è¡¨å¤´æŒ‡é’ˆï¼ŒæŒ‡å‘å­è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td>
                        </tr>
                        <tr>
                            <td><strong>tp</strong></td>
                            <td>è¡¨å°¾æŒ‡é’ˆï¼ŒæŒ‡å‘åŒçº§çš„ä¸‹ä¸€ä¸ªå…ƒç´ </td>
                        </tr>
                    </table>
                </div>

                <div class="section">
                    <h2>ğŸ”§ æ–¹å¼äºŒï¼šæ‰©å±•çº¿æ€§é“¾è¡¨æ³•</h2>
                    <p>åŸå­èŠ‚ç‚¹<strong>æ²¡æœ‰ tp æŒ‡é’ˆ</strong>ï¼Œç»“æ„æ›´ç´§å‡‘ï¼š</p>
                    
                    <div class="node-structure">
                        <div class="node-demo">
                            <div class="node-demo-title">åŸå­èŠ‚ç‚¹ (tag=0)</div>
                            <div class="node-box" style="border-color: #4CAF50;">
                                <div class="node-field tag" style="background: #c8e6c9;">tag=0</div>
                                <div class="node-field atom">atom</div>
                            </div>
                        </div>
                        <div class="node-demo">
                            <div class="node-demo-title">è¡¨èŠ‚ç‚¹ (tag=1)</div>
                            <div class="node-box" style="border-color: #2196F3;">
                                <div class="node-field tag" style="background: #bbdefb;">tag=1</div>
                                <div class="node-field hp">hp</div>
                                <div class="node-field tp">tp</div>
                            </div>
                        </div>
                    </div>

                    <table class="info-table">
                        <tr>
                            <th>ç‰¹ç‚¹</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td><strong>åŸå­èŠ‚ç‚¹</strong></td>
                            <td>åªæœ‰ tag å’Œ atom ä¸¤ä¸ªå­—æ®µï¼Œæ²¡æœ‰ tp</td>
                        </tr>
                        <tr>
                            <td><strong>è¡¨èŠ‚ç‚¹</strong></td>
                            <td>æœ‰ tagã€hpã€tp ä¸‰ä¸ªå­—æ®µï¼ˆä¸æ–¹å¼ä¸€ç›¸åŒï¼‰</td>
                        </tr>
                        <tr>
                            <td><strong>è¿æ¥æ–¹å¼</strong></td>
                            <td>åŸå­ç›´æ¥æŒ‚åœ¨è¡¨èŠ‚ç‚¹çš„ hp ä¸‹ï¼ŒåŒçº§å…ƒç´ é€šè¿‡è¡¨èŠ‚ç‚¹çš„ tp è¿æ¥</td>
                        </tr>
                        <tr>
                            <td><strong>ä¼˜ç‚¹</strong></td>
                            <td>èŠ‚çœåŸå­èŠ‚ç‚¹çš„ç©ºé—´ï¼Œæ¯ä¸ªåŸå­å°‘å­˜ä¸€ä¸ªæŒ‡é’ˆ</td>
                        </tr>
                    </table>
                </div>

                <div class="section">
                    <h2>ğŸ“ ç”»å›¾è§„åˆ™</h2>
                    <h3>Step 1: è¯†åˆ«ç»“æ„</h3>
                    <p>ä»å·¦åˆ°å³æ‰«æå¹¿ä¹‰è¡¨ï¼Œé‡åˆ° <code>(</code> åˆ›å»ºè¡¨èŠ‚ç‚¹ï¼Œé‡åˆ°å­—æ¯åˆ›å»ºåŸå­èŠ‚ç‚¹ã€‚</p>
                    
                    <h3>Step 2: è¿æ¥ hpï¼ˆè¡¨å¤´ï¼‰</h3>
                    <p>è¡¨èŠ‚ç‚¹çš„ <code>hp</code> æŒ‡å‘è¯¥æ‹¬å·å†…çš„<strong>ç¬¬ä¸€ä¸ªå…ƒç´ </strong>ï¼ˆå‘ä¸‹æŒ‡ï¼‰ã€‚</p>
                    
                    <h3>Step 3: è¿æ¥ tpï¼ˆè¡¨å°¾ï¼‰</h3>
                    <p>åŒçº§å…ƒç´ ä¹‹é—´ç”¨ <code>tp</code> ä¸²è”ï¼ˆå‘å³æŒ‡ï¼‰ã€‚æœ€åä¸€ä¸ªå…ƒç´ çš„ <code>tp</code> ä¸º <code>âˆ§</code>ï¼ˆç©ºï¼‰ã€‚</p>
                    
                    <h3>Step 4: é€’å½’å¤„ç†å­è¡¨</h3>
                    <p>å¦‚æœå…ƒç´ æ˜¯å­è¡¨ï¼Œå¯¹å…¶é€’å½’åº”ç”¨ä»¥ä¸Šè§„åˆ™ã€‚</p>
                </div>

                <div class="section">
                    <h2>ğŸ’» Cè¯­è¨€ç»“æ„å®šä¹‰</h2>
                    <h3>æ–¹å¼ä¸€ï¼šå¤´å°¾é“¾è¡¨æ³•</h3>
                    <div class="code-block">
<span class="code-keyword">typedef struct</span> GLNode {
    <span class="code-type">int</span> tag;           <span class="code-comment">// 0: åŸå­, 1: å­è¡¨</span>
    <span class="code-keyword">union</span> {
        <span class="code-type">char</span> atom;      <span class="code-comment">// åŸå­å€¼</span>
        <span class="code-keyword">struct</span> GLNode *hp; <span class="code-comment">// è¡¨å¤´æŒ‡é’ˆ</span>
    };
    <span class="code-keyword">struct</span> GLNode *tp;  <span class="code-comment">// è¡¨å°¾æŒ‡é’ˆ</span>
} GLNode, *GList;
                    </div>
                    <h3>æ–¹å¼äºŒï¼šæ‰©å±•çº¿æ€§é“¾è¡¨æ³•</h3>
                    <div class="code-block">
<span class="code-keyword">typedef struct</span> GLNode {
    <span class="code-type">int</span> tag;           <span class="code-comment">// 0: åŸå­, 1: å­è¡¨</span>
    <span class="code-keyword">union</span> {
        <span class="code-type">char</span> atom;      <span class="code-comment">// tag=0: åŸå­å€¼</span>
        <span class="code-keyword">struct</span> {        <span class="code-comment">// tag=1: è¡¨èŠ‚ç‚¹</span>
            <span class="code-keyword">struct</span> GLNode *hp; <span class="code-comment">// è¡¨å¤´æŒ‡é’ˆ</span>
            <span class="code-keyword">struct</span> GLNode *tp; <span class="code-comment">// è¡¨å°¾æŒ‡é’ˆ</span>
        } ptr;
    };
} GLNode, *GList;
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šäº¤äº’åŒºåŸŸ -->
            <div class="right-panel">
                <div class="section">
                    <h2>ğŸ¨ åœ¨çº¿ç”Ÿæˆå­˜å‚¨ç»“æ„å›¾</h2>
                    
                    <div class="input-group">
                        <label for="glInput">è¾“å…¥å¹¿ä¹‰è¡¨ï¼ˆä½¿ç”¨æ‹¬å·è¡¨ç¤ºæ³•ï¼‰ï¼š</label>
                        <input type="text" id="glInput" placeholder="ä¾‹å¦‚: (a, (b, c), d)" value="(a, (b, c), d)">
                    </div>

                    <div class="input-group">
                        <label>é€‰æ‹©å­˜å‚¨ç»“æ„æ–¹å¼ï¼š</label>
                        <div class="mode-selector">
                            <label class="mode-option">
                                <input type="radio" name="mode" value="mode1" checked onchange="generateGraph()">
                                <span class="mode-label">æ–¹å¼ä¸€ï¼šå¤´å°¾é“¾è¡¨æ³•</span>
                                <span class="mode-desc">ï¼ˆåŸå­èŠ‚ç‚¹æœ‰ tpï¼‰</span>
                            </label>
                            <label class="mode-option">
                                <input type="radio" name="mode" value="mode2" onchange="generateGraph()">
                                <span class="mode-label">æ–¹å¼äºŒï¼šæ‰©å±•çº¿æ€§é“¾è¡¨æ³•</span>
                                <span class="mode-desc">ï¼ˆåŸå­èŠ‚ç‚¹æ—  tpï¼‰</span>
                            </label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="generateGraph()">ğŸš€ ç”Ÿæˆç»“æ„å›¾</button>
                        <button class="btn btn-secondary" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>

                    <p style="margin-top: 10px; color: #666; font-size: 14px;">ç‚¹å‡»ç¤ºä¾‹å¿«é€Ÿå¡«å……ï¼š</p>
                    <div class="example-btns">
                        <button class="example-btn" onclick="setExample('()')">ç©ºè¡¨ ()</button>
                        <button class="example-btn" onclick="setExample('(a, b, c)')">ç®€å• (a,b,c)</button>
                        <button class="example-btn" onclick="setExample('(a, (b, c), d)')">åµŒå¥— (a,(b,c),d)</button>
                        <button class="example-btn" onclick="setExample('((a, b), c)')">å¤´æ˜¯è¡¨ ((a,b),c)</button>
                        <button class="example-btn" onclick="setExample('(a, (b, (c, d)))')">æ·±åµŒå¥—</button>
                        <button class="example-btn" onclick="setExample('((a, b), (c, d))')">åŒå­è¡¨</button>
                    </div>

                    <div id="errorMsg" class="error-msg"></div>
                </div>

                <div class="section">
                    <h2>ğŸ“ å­˜å‚¨ç»“æ„å›¾</h2>
                    <div class="canvas-container">
                        <svg id="glCanvas" width="800" height="400"></svg>
                    </div>
                    
                    <div class="legend" id="legendInfo">
                        <div class="legend-item">
                            <div class="legend-color atom"></div>
                            <span id="atomLegend">åŸå­èŠ‚ç‚¹ (tag=0, å«tp)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color list"></div>
                            <span>è¡¨èŠ‚ç‚¹ (tag=1)</span>
                        </div>
                        <div class="legend-item">
                            <span>â†’ tpæŒ‡é’ˆï¼ˆè¡¨å°¾/åŒçº§ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <span>â†“ hpæŒ‡é’ˆï¼ˆè¡¨å¤´/å­è¡¨ï¼‰</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ“‹ è§£æç»“æœ</h2>
                    <div id="parseResult" class="parse-result">ç­‰å¾…è¾“å…¥å¹¿ä¹‰è¡¨...</div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="../index.html">é¦–é¡µ</a>
                    <a href="https://github.com/FunctionHookTJU" target="_blank">Github</a>
                </div>
                <p class="copyright">Â© 2025 å®‡ä½è§å‡½é’©. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </div>
    </footer>

    <script>
        // ==================== å¹¿ä¹‰è¡¨è§£æå™¨ ====================
        class GLParser {
            constructor(input) {
                this.input = input.replace(/\s/g, ''); // å»é™¤ç©ºæ ¼
                this.pos = 0;
            }

            parse() {
                if (this.pos >= this.input.length) {
                    throw new Error('è¾“å…¥ä¸ºç©º');
                }
                return this.parseList();
            }

            parseList() {
                if (this.input[this.pos] !== '(') {
                    throw new Error(`æœŸæœ› '(' åœ¨ä½ç½® ${this.pos}ï¼Œä½†å¾—åˆ° '${this.input[this.pos]}'`);
                }
                this.pos++; // è·³è¿‡ '('

                const elements = [];

                while (this.pos < this.input.length && this.input[this.pos] !== ')') {
                    if (this.input[this.pos] === ',') {
                        this.pos++; // è·³è¿‡é€—å·
                        continue;
                    }

                    if (this.input[this.pos] === '(') {
                        // å­è¡¨
                        elements.push({ type: 'list', value: this.parseList() });
                    } else {
                        // åŸå­
                        let atom = '';
                        while (this.pos < this.input.length && 
                               this.input[this.pos] !== ',' && 
                               this.input[this.pos] !== ')' &&
                               this.input[this.pos] !== '(') {
                            atom += this.input[this.pos];
                            this.pos++;
                        }
                        if (atom) {
                            elements.push({ type: 'atom', value: atom });
                        }
                    }
                }

                if (this.input[this.pos] !== ')') {
                    throw new Error(`æœŸæœ› ')' åœ¨ä½ç½® ${this.pos}`);
                }
                this.pos++; // è·³è¿‡ ')'

                return elements;
            }
        }

        // ==================== SVG ç»˜å›¾å™¨ ====================
        class GLDrawer {
            constructor(svgId) {
                this.svg = document.getElementById(svgId);
                this.nodeWidth = 120;
                this.atomNodeWidth = 80;  // æ–¹å¼äºŒçš„åŸå­èŠ‚ç‚¹å®½åº¦ï¼ˆæ— tpï¼‰
                this.nodeHeight = 40;
                this.hGap = 60;  // æ°´å¹³é—´è·
                this.vGap = 80;  // å‚ç›´é—´è·
                this.startX = 50;
                this.startY = 50;
                this.nodes = [];
                this.arrows = [];
                this.mode = 'mode1';  // é»˜è®¤æ–¹å¼ä¸€
            }

            setMode(mode) {
                this.mode = mode;
            }

            clear() {
                this.svg.innerHTML = '';
                this.nodes = [];
                this.arrows = [];
            }

            // é€’å½’è®¡ç®—å¸ƒå±€
            calculateLayout(elements, x, y, depth = 0) {
                if (this.mode === 'mode2') {
                    return this.calculateLayoutMode2(elements, x, y, depth);
                }
                return this.calculateLayoutMode1(elements, x, y, depth);
            }

            // æ–¹å¼ä¸€å¸ƒå±€ï¼ˆåŸå­æœ‰tpï¼‰
            calculateLayoutMode1(elements, x, y, depth = 0) {
                let layoutNodes = [];
                let currentX = x;
                let maxY = y;

                for (let i = 0; i < elements.length; i++) {
                    const elem = elements[i];
                    const node = {
                        x: currentX,
                        y: y,
                        type: elem.type,
                        value: elem.type === 'atom' ? elem.value : null,
                        children: null,
                        hasNext: i < elements.length - 1
                    };

                    if (elem.type === 'list') {
                        const childLayout = this.calculateLayoutMode1(elem.value, currentX, y + this.vGap, depth + 1);
                        node.children = childLayout.nodes;
                        maxY = Math.max(maxY, childLayout.maxY);
                        const childWidth = childLayout.maxX - currentX;
                        currentX += Math.max(this.nodeWidth + this.hGap, childWidth);
                    } else {
                        currentX += this.nodeWidth + this.hGap;
                    }

                    layoutNodes.push(node);
                }

                return {
                    nodes: layoutNodes,
                    maxX: currentX,
                    maxY: Math.max(maxY, y + this.nodeHeight)
                };
            }

            // æ–¹å¼äºŒå¸ƒå±€ï¼ˆåŸå­æ— tpï¼Œæ¯ä¸ªå…ƒç´ éƒ½åŒ…è£…åœ¨è¡¨èŠ‚ç‚¹ä¸­ï¼‰
            calculateLayoutMode2(elements, x, y, depth = 0) {
                let layoutNodes = [];
                let currentX = x;
                let maxY = y;

                for (let i = 0; i < elements.length; i++) {
                    const elem = elements[i];
                    
                    // æ–¹å¼äºŒï¼šæ¯ä¸ªå…ƒç´ éƒ½ç”¨è¡¨èŠ‚ç‚¹åŒ…è£…
                    const wrapperNode = {
                        x: currentX,
                        y: y,
                        type: 'wrapper',  // åŒ…è£…è¡¨èŠ‚ç‚¹
                        hasNext: i < elements.length - 1,
                        content: elem
                    };

                    if (elem.type === 'list') {
                        // å­è¡¨ï¼šhpæŒ‡å‘å­è¡¨çš„å†…å®¹
                        const childLayout = this.calculateLayoutMode2(elem.value, currentX, y + this.vGap, depth + 1);
                        wrapperNode.children = childLayout.nodes;
                        maxY = Math.max(maxY, childLayout.maxY);
                        const childWidth = childLayout.maxX - currentX;
                        currentX += Math.max(this.nodeWidth + this.hGap, childWidth);
                    } else {
                        // åŸå­ï¼šhpæŒ‡å‘åŸå­èŠ‚ç‚¹
                        wrapperNode.atomChild = {
                            x: currentX + (this.nodeWidth - this.atomNodeWidth) / 2,
                            y: y + this.vGap,
                            value: elem.value
                        };
                        maxY = Math.max(maxY, y + this.vGap + this.nodeHeight);
                        currentX += this.nodeWidth + this.hGap;
                    }

                    layoutNodes.push(wrapperNode);
                }

                return {
                    nodes: layoutNodes,
                    maxX: currentX,
                    maxY: Math.max(maxY, y + this.nodeHeight)
                };
            }

            // ç»˜åˆ¶æ‰€æœ‰èŠ‚ç‚¹å’Œç®­å¤´
            draw(elements) {
                this.clear();

                if (elements.length === 0) {
                    // ç©ºè¡¨
                    this.drawEmptyList(this.startX, this.startY);
                    this.adjustSvgSize(this.startX + this.nodeWidth + 50, this.startY + this.nodeHeight + 50);
                    return;
                }

                const layout = this.calculateLayout(elements, this.startX, this.startY);
                this.drawNodes(layout.nodes);
                this.adjustSvgSize(layout.maxX + 50, layout.maxY + 100);
            }

            drawNodes(nodes) {
                if (this.mode === 'mode2') {
                    this.drawNodesMode2(nodes);
                } else {
                    this.drawNodesMode1(nodes);
                }
            }

            // æ–¹å¼ä¸€ç»˜åˆ¶
            drawNodesMode1(nodes) {
                for (let i = 0; i < nodes.length; i++) {
                    const node = nodes[i];
                    
                    if (node.type === 'atom') {
                        this.drawAtomNode(node.x, node.y, node.value);
                    } else {
                        this.drawListNode(node.x, node.y);
                        if (node.children && node.children.length > 0) {
                            const child = node.children[0];
                            this.drawArrow(
                                node.x + this.nodeWidth / 2,
                                node.y + this.nodeHeight,
                                child.x + this.nodeWidth / 2,
                                child.y,
                                'hp'
                            );
                            this.drawNodesMode1(node.children);
                        } else {
                            this.drawNullPointer(node.x + this.nodeWidth / 2, node.y + this.nodeHeight, 'down');
                        }
                    }

                    if (node.hasNext && i < nodes.length - 1) {
                        const nextNode = nodes[i + 1];
                        this.drawArrow(
                            node.x + this.nodeWidth,
                            node.y + this.nodeHeight / 2,
                            nextNode.x,
                            nextNode.y + this.nodeHeight / 2,
                            'tp'
                        );
                    } else {
                        this.drawNullSymbol(node.x + this.nodeWidth - 15, node.y + this.nodeHeight / 2);
                    }
                }
            }

            // æ–¹å¼äºŒç»˜åˆ¶
            drawNodesMode2(nodes) {
                for (let i = 0; i < nodes.length; i++) {
                    const node = nodes[i];
                    
                    // ç»˜åˆ¶åŒ…è£…è¡¨èŠ‚ç‚¹
                    this.drawListNode(node.x, node.y);

                    if (node.content.type === 'atom') {
                        // åŸå­ï¼šç»˜åˆ¶æ— tpçš„åŸå­èŠ‚ç‚¹
                        this.drawAtomNodeNoTp(node.atomChild.x, node.atomChild.y, node.atomChild.value);
                        // hpç®­å¤´æŒ‡å‘åŸå­
                        this.drawArrow(
                            node.x + this.nodeWidth / 2,
                            node.y + this.nodeHeight,
                            node.atomChild.x + this.atomNodeWidth / 2,
                            node.atomChild.y,
                            'hp'
                        );
                    } else {
                        // å­è¡¨ï¼šhpç®­å¤´æŒ‡å‘å­è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
                        if (node.children && node.children.length > 0) {
                            const child = node.children[0];
                            this.drawArrow(
                                node.x + this.nodeWidth / 2,
                                node.y + this.nodeHeight,
                                child.x + this.nodeWidth / 2,
                                child.y,
                                'hp'
                            );
                            this.drawNodesMode2(node.children);
                        } else {
                            this.drawNullPointer(node.x + this.nodeWidth / 2, node.y + this.nodeHeight, 'down');
                        }
                    }

                    // tpç®­å¤´
                    if (node.hasNext && i < nodes.length - 1) {
                        const nextNode = nodes[i + 1];
                        this.drawArrow(
                            node.x + this.nodeWidth,
                            node.y + this.nodeHeight / 2,
                            nextNode.x,
                            nextNode.y + this.nodeHeight / 2,
                            'tp'
                        );
                    } else {
                        this.drawNullSymbol(node.x + this.nodeWidth - 15, node.y + this.nodeHeight / 2);
                    }
                }
            }

            drawAtomNode(x, y, value) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // èŠ‚ç‚¹èƒŒæ™¯
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', this.nodeWidth);
                rect.setAttribute('height', this.nodeHeight);
                rect.setAttribute('fill', '#e8f5e9');
                rect.setAttribute('stroke', '#4CAF50');
                rect.setAttribute('stroke-width', '2');
                rect.setAttribute('rx', '4');
                g.appendChild(rect);

                // åˆ†éš”çº¿
                const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line1.setAttribute('x1', x + 30);
                line1.setAttribute('y1', y);
                line1.setAttribute('x2', x + 30);
                line1.setAttribute('y2', y + this.nodeHeight);
                line1.setAttribute('stroke', '#4CAF50');
                line1.setAttribute('stroke-width', '1');
                g.appendChild(line1);

                const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line2.setAttribute('x1', x + this.nodeWidth - 30);
                line2.setAttribute('y1', y);
                line2.setAttribute('x2', x + this.nodeWidth - 30);
                line2.setAttribute('y2', y + this.nodeHeight);
                line2.setAttribute('stroke', '#4CAF50');
                line2.setAttribute('stroke-width', '1');
                g.appendChild(line2);

                // tag = 0
                const tagText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tagText.setAttribute('x', x + 15);
                tagText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                tagText.setAttribute('text-anchor', 'middle');
                tagText.setAttribute('font-size', '12');
                tagText.setAttribute('font-family', 'monospace');
                tagText.setAttribute('fill', '#333');
                tagText.textContent = '0';
                g.appendChild(tagText);

                // atom value
                const atomText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                atomText.setAttribute('x', x + this.nodeWidth / 2);
                atomText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                atomText.setAttribute('text-anchor', 'middle');
                atomText.setAttribute('font-size', '14');
                atomText.setAttribute('font-weight', 'bold');
                atomText.setAttribute('font-family', 'monospace');
                atomText.setAttribute('fill', '#2e7d32');
                atomText.textContent = value;
                g.appendChild(atomText);

                // tp åŒºåŸŸï¼ˆå³ä¾§å°æ ¼å­ï¼Œç•™ç©ºè¡¨ç¤ºæŒ‡é’ˆï¼‰
                const tpText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tpText.setAttribute('x', x + this.nodeWidth - 15);
                tpText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                tpText.setAttribute('text-anchor', 'middle');
                tpText.setAttribute('font-size', '10');
                tpText.setAttribute('fill', '#666');
                tpText.textContent = 'tp';
                g.appendChild(tpText);

                this.svg.appendChild(g);
            }

            // æ–¹å¼äºŒï¼šæ— tpçš„åŸå­èŠ‚ç‚¹
            drawAtomNodeNoTp(x, y, value) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // èŠ‚ç‚¹èƒŒæ™¯ï¼ˆæ›´çª„ï¼Œåªæœ‰tagå’Œatomï¼‰
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', this.atomNodeWidth);
                rect.setAttribute('height', this.nodeHeight);
                rect.setAttribute('fill', '#c8e6c9');
                rect.setAttribute('stroke', '#2e7d32');
                rect.setAttribute('stroke-width', '2');
                rect.setAttribute('rx', '4');
                g.appendChild(rect);

                // åˆ†éš”çº¿ï¼ˆåªæœ‰ä¸€æ¡ï¼‰
                const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line1.setAttribute('x1', x + 25);
                line1.setAttribute('y1', y);
                line1.setAttribute('x2', x + 25);
                line1.setAttribute('y2', y + this.nodeHeight);
                line1.setAttribute('stroke', '#2e7d32');
                line1.setAttribute('stroke-width', '1');
                g.appendChild(line1);

                // tag = 0
                const tagText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tagText.setAttribute('x', x + 12);
                tagText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                tagText.setAttribute('text-anchor', 'middle');
                tagText.setAttribute('font-size', '12');
                tagText.setAttribute('font-family', 'monospace');
                tagText.setAttribute('fill', '#1b5e20');
                tagText.textContent = '0';
                g.appendChild(tagText);

                // atom value
                const atomText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                atomText.setAttribute('x', x + 25 + (this.atomNodeWidth - 25) / 2);
                atomText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                atomText.setAttribute('text-anchor', 'middle');
                atomText.setAttribute('font-size', '14');
                atomText.setAttribute('font-weight', 'bold');
                atomText.setAttribute('font-family', 'monospace');
                atomText.setAttribute('fill', '#1b5e20');
                atomText.textContent = value;
                g.appendChild(atomText);

                this.svg.appendChild(g);
            }

            drawListNode(x, y) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // èŠ‚ç‚¹èƒŒæ™¯
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', this.nodeWidth);
                rect.setAttribute('height', this.nodeHeight);
                rect.setAttribute('fill', '#e3f2fd');
                rect.setAttribute('stroke', '#2196F3');
                rect.setAttribute('stroke-width', '2');
                rect.setAttribute('rx', '4');
                g.appendChild(rect);

                // åˆ†éš”çº¿
                const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line1.setAttribute('x1', x + 30);
                line1.setAttribute('y1', y);
                line1.setAttribute('x2', x + 30);
                line1.setAttribute('y2', y + this.nodeHeight);
                line1.setAttribute('stroke', '#2196F3');
                line1.setAttribute('stroke-width', '1');
                g.appendChild(line1);

                const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line2.setAttribute('x1', x + this.nodeWidth - 30);
                line2.setAttribute('y1', y);
                line2.setAttribute('x2', x + this.nodeWidth - 30);
                line2.setAttribute('y2', y + this.nodeHeight);
                line2.setAttribute('stroke', '#2196F3');
                line2.setAttribute('stroke-width', '1');
                g.appendChild(line2);

                // tag = 1
                const tagText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tagText.setAttribute('x', x + 15);
                tagText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                tagText.setAttribute('text-anchor', 'middle');
                tagText.setAttribute('font-size', '12');
                tagText.setAttribute('font-family', 'monospace');
                tagText.setAttribute('fill', '#333');
                tagText.textContent = '1';
                g.appendChild(tagText);

                // hp
                const hpText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                hpText.setAttribute('x', x + this.nodeWidth / 2);
                hpText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                hpText.setAttribute('text-anchor', 'middle');
                hpText.setAttribute('font-size', '10');
                hpText.setAttribute('fill', '#1565c0');
                hpText.textContent = 'hp';
                g.appendChild(hpText);

                // tp
                const tpText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                tpText.setAttribute('x', x + this.nodeWidth - 15);
                tpText.setAttribute('y', y + this.nodeHeight / 2 + 5);
                tpText.setAttribute('text-anchor', 'middle');
                tpText.setAttribute('font-size', '10');
                tpText.setAttribute('fill', '#666');
                tpText.textContent = 'tp';
                g.appendChild(tpText);

                this.svg.appendChild(g);
            }

            drawArrow(x1, y1, x2, y2, type) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // è®¡ç®—æ§åˆ¶ç‚¹å®ç°å¹³æ»‘æ›²çº¿
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                
                let d;
                if (type === 'hp') {
                    // å‚ç›´å‘ä¸‹çš„ç®­å¤´
                    d = `M ${x1} ${y1} L ${x1} ${y2 - 10}`;
                } else {
                    // æ°´å¹³ç®­å¤´
                    const midY = (y1 + y2) / 2;
                    d = `M ${x1} ${y1} L ${x2 - 10} ${y2}`;
                }
                
                path.setAttribute('d', d);
                path.setAttribute('stroke', '#666');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('fill', 'none');
                path.setAttribute('marker-end', 'url(#arrowhead)');
                g.appendChild(path);

                this.svg.appendChild(g);
                this.ensureArrowMarker();
            }

            drawNullSymbol(x, y) {
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', y + 4);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '14');
                text.setAttribute('font-weight', 'bold');
                text.setAttribute('fill', '#999');
                text.textContent = 'âˆ§';
                this.svg.appendChild(text);
            }

            drawNullPointer(x, y, direction) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                // çŸ­çº¿
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', y);
                line.setAttribute('x2', x);
                line.setAttribute('y2', y + 20);
                line.setAttribute('stroke', '#999');
                line.setAttribute('stroke-width', '2');
                g.appendChild(line);

                // null ç¬¦å·
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', y + 35);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', '#999');
                text.textContent = 'âˆ§';
                g.appendChild(text);

                this.svg.appendChild(g);
            }

            drawEmptyList(x, y) {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', this.nodeWidth);
                rect.setAttribute('height', this.nodeHeight);
                rect.setAttribute('fill', '#f5f5f5');
                rect.setAttribute('stroke', '#999');
                rect.setAttribute('stroke-width', '2');
                rect.setAttribute('stroke-dasharray', '5,5');
                rect.setAttribute('rx', '4');
                g.appendChild(rect);

                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x + this.nodeWidth / 2);
                text.setAttribute('y', y + this.nodeHeight / 2 + 5);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '14');
                text.setAttribute('fill', '#999');
                text.textContent = 'NULL (ç©ºè¡¨)';
                g.appendChild(text);

                this.svg.appendChild(g);
            }

            ensureArrowMarker() {
                if (!document.getElementById('arrowhead')) {
                    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                    marker.setAttribute('id', 'arrowhead');
                    marker.setAttribute('markerWidth', '10');
                    marker.setAttribute('markerHeight', '7');
                    marker.setAttribute('refX', '9');
                    marker.setAttribute('refY', '3.5');
                    marker.setAttribute('orient', 'auto');
                    
                    const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
                    polygon.setAttribute('fill', '#666');
                    
                    marker.appendChild(polygon);
                    defs.appendChild(marker);
                    this.svg.insertBefore(defs, this.svg.firstChild);
                }
            }

            adjustSvgSize(width, height) {
                this.svg.setAttribute('width', Math.max(width, 800));
                this.svg.setAttribute('height', Math.max(height, 400));
            }
        }

        // ==================== å…¨å±€å‡½æ•° ====================
        const drawer = new GLDrawer('glCanvas');

        function generateGraph() {
            const input = document.getElementById('glInput').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const parseResult = document.getElementById('parseResult');
            const mode = document.querySelector('input[name="mode"]:checked').value;

            errorMsg.classList.remove('show');
            errorMsg.textContent = '';

            // æ›´æ–°å›¾ä¾‹æ–‡å­—
            const atomLegend = document.getElementById('atomLegend');
            if (mode === 'mode1') {
                atomLegend.textContent = 'åŸå­èŠ‚ç‚¹ (tag=0, å«tp)';
            } else {
                atomLegend.textContent = 'åŸå­èŠ‚ç‚¹ (tag=0, æ— tp)';
            }

            if (!input) {
                showError('è¯·è¾“å…¥å¹¿ä¹‰è¡¨ï¼');
                return;
            }

            try {
                const parser = new GLParser(input);
                const elements = parser.parse();

                // è®¾ç½®æ¨¡å¼å¹¶ç»˜åˆ¶
                drawer.setMode(mode);

                // æ˜¾ç¤ºè§£æç»“æœ
                parseResult.textContent = formatParseResult(input, elements, mode);

                // ç»˜åˆ¶å›¾å½¢
                drawer.draw(elements);

            } catch (e) {
                showError('è§£æé”™è¯¯: ' + e.message);
                parseResult.textContent = 'è§£æå¤±è´¥: ' + e.message;
            }
        }

        function formatParseResult(input, elements, mode = 'mode1') {
            let result = `è¾“å…¥: ${input}\n`;
            result += `æ¨¡å¼: ${mode === 'mode1' ? 'æ–¹å¼ä¸€ï¼ˆå¤´å°¾é“¾è¡¨æ³•ï¼‰' : 'æ–¹å¼äºŒï¼ˆæ‰©å±•çº¿æ€§é“¾è¡¨æ³•ï¼‰'}\n`;
            result += `\nè§£æç»“æ„:\n`;
            result += formatElements(elements, 0);
            result += `\nèŠ‚ç‚¹ç»Ÿè®¡:\n`;
            const stats = countNodes(elements);
            if (mode === 'mode1') {
                result += `  åŸå­èŠ‚ç‚¹: ${stats.atoms} ä¸ªï¼ˆå«tpæŒ‡é’ˆï¼‰\n`;
                result += `  è¡¨èŠ‚ç‚¹: ${stats.lists} ä¸ª\n`;
                result += `  æ€»èŠ‚ç‚¹: ${stats.atoms + stats.lists} ä¸ª\n`;
            } else {
                result += `  åŸå­èŠ‚ç‚¹: ${stats.atoms} ä¸ªï¼ˆæ— tpæŒ‡é’ˆï¼‰\n`;
                result += `  åŒ…è£…è¡¨èŠ‚ç‚¹: ${stats.atoms + stats.lists} ä¸ª\n`;
                result += `  æ€»èŠ‚ç‚¹: ${stats.atoms + stats.atoms + stats.lists} ä¸ª\n`;
            }
            result += `  åµŒå¥—æ·±åº¦: ${stats.depth} å±‚`;
            return result;
        }

        function formatElements(elements, level) {
            let result = '';
            const prefix = '  '.repeat(level);
            
            for (let i = 0; i < elements.length; i++) {
                const elem = elements[i];
                if (elem.type === 'atom') {
                    result += `${prefix}â”œâ”€ [åŸå­] ${elem.value}\n`;
                } else {
                    result += `${prefix}â”œâ”€ [å­è¡¨]\n`;
                    result += formatElements(elem.value, level + 1);
                }
            }
            return result;
        }

        function countNodes(elements, depth = 1) {
            let atoms = 0;
            let lists = 0;
            let maxDepth = depth;

            for (const elem of elements) {
                if (elem.type === 'atom') {
                    atoms++;
                } else {
                    lists++;
                    const childStats = countNodes(elem.value, depth + 1);
                    atoms += childStats.atoms;
                    lists += childStats.lists;
                    maxDepth = Math.max(maxDepth, childStats.depth);
                }
            }

            return { atoms, lists, depth: maxDepth };
        }

        function showError(msg) {
            const errorMsg = document.getElementById('errorMsg');
            errorMsg.textContent = msg;
            errorMsg.classList.add('show');
        }

        function clearCanvas() {
            drawer.clear();
            document.getElementById('glInput').value = '';
            document.getElementById('parseResult').textContent = 'ç­‰å¾…è¾“å…¥å¹¿ä¹‰è¡¨...';
            document.getElementById('errorMsg').classList.remove('show');
        }

        function setExample(example) {
            document.getElementById('glInput').value = example;
            generateGraph();
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹
        window.addEventListener('load', function() {
            setTimeout(generateGraph, 500);
        });
    </script>
</body>
</html>