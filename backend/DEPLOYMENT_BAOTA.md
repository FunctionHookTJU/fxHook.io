# fxHook.io æ—¥è®°ç³»ç»Ÿ - å®å¡”é¢æ¿éƒ¨ç½²æ–‡æ¡£

> é€‚ç”¨äºŽ Ubuntu 22.04 + å®å¡”é¢æ¿çŽ¯å¢ƒ

## ç³»ç»Ÿæž¶æž„

- **å‰ç«¯**: é™æ€HTMLé¡µé¢ + JavaScript
- **åŽç«¯**: Node.js + Express
- **æ•°æ®åº“**: MongoDB
- **æœåŠ¡å™¨**: Ubuntu 22.04 + å®å¡”é¢æ¿

---

## ä¸€ã€å®å¡”é¢æ¿å‡†å¤‡å·¥ä½œ

### 1. å®‰è£…å®å¡”é¢æ¿ï¼ˆå¦‚æœªå®‰è£…ï¼‰

```bash
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

å®‰è£…å®ŒæˆåŽè®°å½•ï¼š
- å®å¡”é¢æ¿åœ°å€ï¼ˆå¦‚ï¼š`http://your-ip:8888`ï¼‰
- ç”¨æˆ·åå’Œå¯†ç 

### 2. ç™»å½•å®å¡”é¢æ¿

è®¿é—®é¢æ¿åœ°å€ï¼Œä½¿ç”¨è´¦å·å¯†ç ç™»å½•

---

## äºŒã€å®‰è£…å¿…è¦è½¯ä»¶

### 1. åœ¨å®å¡”é¢æ¿å®‰è£…è½¯ä»¶

**è½¯ä»¶å•†åº—** â†’ æœç´¢å¹¶å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š

#### â‘  Nginxï¼ˆå¿…è£…ï¼‰
- ç‰ˆæœ¬ï¼š1.22 æˆ–æ›´é«˜
- ç”¨é€”ï¼šWebæœåŠ¡å™¨å’Œåå‘ä»£ç†

#### â‘¡ PM2ç®¡ç†å™¨ï¼ˆå¿…è£…ï¼‰
- ç”¨é€”ï¼šNode.jsè¿›ç¨‹ç®¡ç†
- åœ¨ **è½¯ä»¶å•†åº—** â†’ **è¿è¡ŒçŽ¯å¢ƒ** â†’ æœç´¢ "PM2ç®¡ç†å™¨" â†’ å®‰è£…

#### â‘¢ MongoDBï¼ˆå¿…è£…ï¼‰
- ç‰ˆæœ¬ï¼šæŽ¨è 5.0 æˆ–æ›´é«˜
- åœ¨ **è½¯ä»¶å•†åº—** â†’ **æ•°æ®åº“** â†’ æœç´¢ "MongoDB" â†’ å®‰è£…
- å®‰è£…å®ŒæˆåŽè®°å½•ç”¨æˆ·åå’Œå¯†ç ï¼ˆå¦‚æžœè®¾ç½®äº†ï¼‰

**å¦‚æžœè½¯ä»¶å•†åº—æ²¡æœ‰MongoDB**ï¼Œæ‰‹åŠ¨å®‰è£…ï¼š

```bash
# SSHè¿žæŽ¥åˆ°æœåŠ¡å™¨
cd /opt

# ä¸‹è½½MongoDB
wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu2204-7.0.5.tgz

# è§£åŽ‹
tar -zxvf mongodb-linux-x86_64-ubuntu2204-7.0.5.tgz
mv mongodb-linux-x86_64-ubuntu2204-7.0.5 mongodb

# åˆ›å»ºæ•°æ®å’Œæ—¥å¿—ç›®å½•
mkdir -p /data/mongodb/data
mkdir -p /data/mongodb/logs

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /opt/mongodb/mongodb.conf << EOF
systemLog:
  destination: file
  path: /data/mongodb/logs/mongodb.log
  logAppend: true
storage:
  dbPath: /data/mongodb/data
  journal:
    enabled: true
net:
  port: 27017
  bindIp: 127.0.0.1
EOF

# åˆ›å»ºsystemdæœåŠ¡
cat > /etc/systemd/system/mongodb.service << EOF
[Unit]
Description=MongoDB Database Server
After=network.target

[Service]
Type=forking
User=root
ExecStart=/opt/mongodb/bin/mongod --config /opt/mongodb/mongodb.conf --fork
ExecStop=/opt/mongodb/bin/mongod --shutdown --config /opt/mongodb/mongodb.conf
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨MongoDB
systemctl daemon-reload
systemctl start mongodb
systemctl enable mongodb

# æ£€æŸ¥çŠ¶æ€
systemctl status mongodb
```

---

## ä¸‰ã€ä¸Šä¼ é¡¹ç›®ä»£ç 

### æ–¹å¼1ï¼šä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†å™¨

1. æ‰“å¼€ **æ–‡ä»¶** èœå•
2. å¯¼èˆªåˆ° `/www/wwwroot/`
3. ç‚¹å‡» **ä¸Šä¼ ** â†’ ä¸Šä¼ æ•´ä¸ª `fxHook.io` é¡¹ç›®åŽ‹ç¼©åŒ…
4. è§£åŽ‹æ–‡ä»¶

### æ–¹å¼2ï¼šä½¿ç”¨Gitï¼ˆæŽ¨èï¼‰

åœ¨å®å¡”é¢æ¿ **ç»ˆç«¯** æˆ–SSHä¸­æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/
git clone https://github.com/FunctionHookTJU/fxHook.io.git
cd fxHook.io
git checkout dynamic
```

---

## å››ã€é…ç½®åŽç«¯æœåŠ¡

### 1. è¿›å…¥åŽç«¯ç›®å½•

```bash
cd /www/wwwroot/fxHook.io/backend
```

### 2. é…ç½®çŽ¯å¢ƒå˜é‡

ä½¿ç”¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†å™¨ç¼–è¾‘ï¼Œæˆ–å‘½ä»¤è¡Œï¼š

```bash
cp .env.example .env
nano .env
```

ä¿®æ”¹ `.env` å†…å®¹ï¼š

```env
# æœåŠ¡å™¨ç«¯å£
PORT=3000

# MongoDBè¿žæŽ¥ï¼ˆæœ¬åœ°ï¼‰
MONGODB_URI=mongodb://127.0.0.1:27017/fxhook_diary

# JWTå¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=è¯·ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„è¶…é•¿éšæœºå­—ç¬¦ä¸²è‡³å°‘32ä½

# ç®¡ç†å‘˜å¯†ç ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
ADMIN_PASSWORD=è¯·è®¾ç½®ä½ çš„å¼ºå¯†ç 

# CORSé…ç½®ï¼ˆä½ çš„åŸŸåï¼‰
ALLOWED_ORIGINS=https://fxhook.fun,https://www.fxhook.fun,https://functionhooktju.github.io
```

ä¿å­˜é€€å‡ºï¼ˆCtrl+X â†’ Y â†’ Enterï¼‰

### 3. å®‰è£…ä¾èµ–

#### æ–¹æ³•Aï¼šåœ¨å®å¡”ç»ˆç«¯å®‰è£…ï¼ˆæŽ¨èï¼‰

æ‰“å¼€ **ç»ˆç«¯**ï¼š

```bash
cd /www/wwwroot/fxHook.io/backend
npm install
```

#### æ–¹æ³•Bï¼šä½¿ç”¨PM2ç®¡ç†å™¨å®‰è£…

1. æ‰“å¼€ **è½¯ä»¶å•†åº—** â†’ **PM2ç®¡ç†å™¨**
2. ç‚¹å‡» **é¡¹ç›®ç®¡ç†** â†’ **æ·»åŠ é¡¹ç›®**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **é¡¹ç›®åç§°**ï¼šfxhook-diary
   - **é¡¹ç›®è·¯å¾„**ï¼š`/www/wwwroot/fxHook.io/backend`
   - **å¯åŠ¨æ–‡ä»¶**ï¼š`server.js`
   - **è¿è¡Œç›®å½•**ï¼š`/www/wwwroot/fxHook.io/backend`
4. ç‚¹å‡» **å®‰è£…ä¾èµ–**ï¼ˆä¼šè‡ªåŠ¨è¿è¡Œnpm installï¼‰

### 4. å¯åŠ¨Node.jsæœåŠ¡

#### ä½¿ç”¨PM2ç®¡ç†å™¨å¯åŠ¨ï¼ˆæŽ¨èï¼‰

1. åœ¨PM2ç®¡ç†å™¨çš„é¡¹ç›®åˆ—è¡¨ä¸­æ‰¾åˆ° `fxhook-diary`
2. ç‚¹å‡» **å¯åŠ¨**
3. è®¾ç½® **å¼€æœºè‡ªå¯**

#### æˆ–ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
cd /www/wwwroot/fxHook.io/backend
pm2 start server.js --name fxhook-diary
pm2 save
pm2 startup
```

### 5. æ£€æŸ¥æœåŠ¡çŠ¶æ€

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
pm2 status
pm2 logs fxhook-diary
```

æˆ–åœ¨PM2ç®¡ç†å™¨ä¸­æŸ¥çœ‹æ—¥å¿—

---

## äº”ã€é…ç½®Nginxåå‘ä»£ç†

### 1. æ·»åŠ ç½‘ç«™

1. æ‰“å¼€ **ç½‘ç«™** èœå•
2. ç‚¹å‡» **æ·»åŠ ç«™ç‚¹**
3. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**ï¼š`api.fxhook.cn`ï¼ˆä½ çš„APIåŸŸåï¼‰
   - **æ ¹ç›®å½•**ï¼šéšä¾¿é€‰ä¸€ä¸ªï¼Œç¨åŽä¼šä¿®æ”¹
   - **PHPç‰ˆæœ¬**ï¼šçº¯é™æ€
4. ç‚¹å‡» **æäº¤**

### 2. é…ç½®åå‘ä»£ç†

1. åœ¨ç½‘ç«™åˆ—è¡¨ä¸­æ‰¾åˆ° `api.fxhook.cn`
2. ç‚¹å‡» **è®¾ç½®**
3. ç‚¹å‡»å·¦ä¾§ **åå‘ä»£ç†**
4. ç‚¹å‡» **æ·»åŠ åå‘ä»£ç†**
5. å¡«å†™ï¼š
   - **ä»£ç†åç§°**ï¼šfxhook-api
   - **ç›®æ ‡URL**ï¼š`http://127.0.0.1:3000`
   - **å‘é€åŸŸå**ï¼š`$host`
6. **é«˜çº§è®¾ç½®**ï¼ˆå¯é€‰ï¼‰ï¼š

```nginx
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header Host $host;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";
```

7. ç‚¹å‡» **æäº¤**

### 3. é…ç½®HTTPSï¼ˆå…è´¹SSLè¯ä¹¦ï¼‰

1. åœ¨ç½‘ç«™è®¾ç½®ä¸­ç‚¹å‡» **SSL**
2. é€‰æ‹© **Let's Encrypt**
3. å‹¾é€‰ä½ çš„åŸŸå
4. ç‚¹å‡» **ç”³è¯·**
5. ç­‰å¾…è¯ä¹¦ç­¾å‘ï¼ˆé€šå¸¸å‡ ç§’é’Ÿï¼‰
6. å¼€å¯ **å¼ºåˆ¶HTTPS**

---

## å…­ã€éƒ¨ç½²å‰ç«¯

### æ–¹å¼1ï¼šä½¿ç”¨çŽ°æœ‰ç½‘ç«™ï¼ˆå¦‚æžœå·²ç»æœ‰ï¼‰

å¦‚æžœä½ å·²ç»æœ‰ä¸»ç½‘ç«™ï¼ˆå¦‚ `fxhook.cn`ï¼‰ï¼š

1. å‰ç«¯æ–‡ä»¶å·²ç»åœ¨ `/www/wwwroot/fxHook.io/` ç›®å½•
2. åœ¨å®å¡”é¢æ¿ **ç½‘ç«™** â†’ æ‰¾åˆ°ä½ çš„ä¸»ç½‘ç«™
3. ç‚¹å‡» **è®¾ç½®** â†’ **ç½‘ç«™ç›®å½•**
4. å°†è¿è¡Œç›®å½•è®¾ç½®ä¸º `/www/wwwroot/fxHook.io`

### æ–¹å¼2ï¼šåˆ›å»ºæ–°ç½‘ç«™

1. ç‚¹å‡» **æ·»åŠ ç«™ç‚¹**
2. å¡«å†™ï¼š
   - **åŸŸå**ï¼š`fxhook.cn` æˆ– `www.fxhook.cn`
   - **æ ¹ç›®å½•**ï¼š`/www/wwwroot/fxHook.io`
   - **PHPç‰ˆæœ¬**ï¼šçº¯é™æ€
3. ç‚¹å‡» **æäº¤**
4. é…ç½®SSLè¯ä¹¦ï¼ˆåŒä¸Šï¼‰

### ä¿®æ”¹APIåœ°å€

ä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨æˆ–å‘½ä»¤è¡Œç¼–è¾‘ï¼š

```bash
nano /www/wwwroot/fxHook.io/scripts/diaryAPI.js
```

ä¿®æ”¹ç¬¬2è¡Œï¼š

```javascript
// const API_BASE_URL = 'http://localhost:3000/api'; // å¼€å‘çŽ¯å¢ƒ
const API_BASE_URL = 'https://api.fxhook.cn/api'; // æ”¹ä¸ºä½ çš„APIåŸŸå
```

ä¿å­˜æ–‡ä»¶

---

## ä¸ƒã€æ•°æ®è¿ç§»ï¼ˆè¿ç§»çŽ°æœ‰æ—¥è®°ï¼‰

### 1. åˆ›å»ºè¿ç§»è„šæœ¬

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨æˆ–ç»ˆç«¯åˆ›å»ºæ–‡ä»¶ï¼š

```bash
nano /www/wwwroot/fxHook.io/backend/migrate.js
```

ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼Œå¹¶**å¡«å…¥ä½ çš„æ‰€æœ‰æ—¥è®°æ•°æ®**ï¼š

```javascript
require('dotenv').config();
const mongoose = require('mongoose');
const Diary = require('./models/Diary');

// ä½ çš„æ‰€æœ‰æ—¥è®°æ•°æ®
const existingDiaries = [
  {
    date: new Date('2026-01-21'),
    title: '',
    content: 'ä»Šå¤©ç»ˆäºŽæŠŠå‰å‡ é—¨æ¶å¿ƒçš„è¯¾ç»™è€ƒå®Œäº†ï¼Œå¤§ç‰©ç«Ÿç„¶è€ƒçš„éƒ½ä¼šï¼Œåªæ˜¯æ¦‚çŽ‡è®ºå‡ºæˆç»©ï¼Œå æœºäº†ã€‚\næ˜Žå¤©GTM8+ 11:00æ˜Žæ—¥æ–¹èˆŸç»ˆæœ«åœ°å¼€æœï¼ŒæœŸå¾…ä¸­......',
    images: []
  },
  {
    date: new Date('2026-01-16'),
    title: '',
    content: 'æˆ‘æ¨è®¡ç®—æœºç³»ç»ŸåŸºç¡€2ã€‚æˆ‘æ¨æ•°æ®ç»“æž„ã€‚æ¥è‡ªè€ƒè¯•å‰æ·±å¤œçš„æ€’å¼ã€‚æœ¬æ¥åˆ†é…äº”å¤©æ—¶é—´å‡†å¤‡ä¸€åŠå­¦csappå¦ä¸€åŠå­¦æ•°æ®ç»“æž„çš„ï¼Œç»“æžœå…‰å¤ä¹ csappçš„pptå°±ç”¨æŽ‰äº†å››å¤©çš„æ—¶é—´ã€‚æ•°æ®ç»“æž„è¿˜æœ‰é‚£ä¹ˆå¤šè´¼å‡ æŠŠé•¿çš„çº¸é¢ä½œä¸šè¦å†™ï¼Œè€ƒå®Œæ•°æ®ç»“æž„è¿˜è¦å¤ä¹ è‹±è¯­å’Œå¤§ç‰©ï¼Œè°ä»–å¦ˆæœ‰åŠŸå¤«å†™ä½ é‚£çº¸é¢ä½œä¸šå•Šï¼Œæˆ‘èƒ½å‡‘åˆç€ç»™ä½ å†™å†™ç®—æ³•é¢˜å°±ä¸é”™äº†ï¼Œä»–å¦ˆçš„åˆè‡­åˆé•¿ã€‚åŽ»æ­»å§åŽ»æ­»åŽ»æ­»åŽ»æ­»ï¼',
    images: []
  },
  {
    date: new Date('2026-01-01'),
    title: '',
    content: '2026æ–°å¹´å¿«ä¹ï¼ä¹Ÿæ˜¯ç»ˆäºŽç†¬åˆ°copilotå…è´¹é¢åº¦åˆ·æ–°çš„æ—¶å€™äº†ã€‚ä¸Šä¸ªæœˆæœˆåˆç”¨æŽ‰äº†å¤ªå¤šé¢åº¦æ¥åšé‚£ä¸ªæ²¡ç”¨çš„ç½‘é¡µã€‚æœ€è¿‘ä¹Ÿæ˜¯åˆ°æœŸæœ«å¤ä¹ çš„é˜¶æ®µäº†ï¼Œä¹Ÿæ˜¯åå¤šå¤©æ²¡ä¿®ç†è¿‡è¿™ä¸ªç½‘é¡µäº†ï¼Œä¹°äº†æœåŠ¡å™¨ä¹‹åŽä¹Ÿæ²¡æ€Žä¹ˆåœ¨æ„æŠŠè¿™ä¸ªç½‘é¡µéƒ¨ç½²ä¸ŠåŽ»ï¼Œåœ¨é‚£ä¸ªæœåŠ¡å™¨é‡Œéƒ¨ç½²äº†åŽŸç‰ˆmcï¼Œå´å› ä¸ºå†…å­˜å¤ªå°‘æ€»æ˜¯é—ªé€€ï¼ŒäºŽæ˜¯æœåŠ¡å™¨å·²ç»è¿žç»­å¾ˆå¤šå¤©å¤„äºŽä¸€ä¸ªé—²ç½®çš„çŠ¶æ€ã€‚æœ‰æ—¶é—´è¦æžä¸€ä¸ªæ™®é€štcpåè®®çš„å°ç¨‹åºçŽ©çŽ©ã€‚',
    images: []
  },
  {
    date: new Date('2025-12-20'),
    title: '',
    content: 'è‡ªä»ŽæŠŠæœåŠ¡å™¨çš„é•œåƒæ¢æˆubuntuä¹‹åŽï¼Œæˆ‘çªç„¶å°±æ„Ÿå—åˆ°linuxç³»ç»Ÿå‘½ä»¤è¡Œæ“ä½œçš„ç¾Žæ„Ÿäº†ã€‚å®å¡”é¢æ¿åˆç¼“è§£äº†linuxç³»ç»ŸæŸ¥çœ‹æ–‡ä»¶ç»“æž„ä¸æ–¹ä¾¿çš„éš¾é¢˜ï¼Œè€Œä¸”å®å¡”é¢æ¿çš„å‘½ä»¤è¡Œæ˜¯ç”¨8888ç«¯å£ç›´è¿žçš„ï¼Œä¸ä¼šåƒsshé‚£æ ·å ç”¨å¤§é‡èµ„æºã€‚æˆ‘çœŸçš„è¦çˆ±ä¸Šlinuxç³»ç»Ÿäº†ã€‚',
    images: []
  }
  // ... ç»§ç»­æ·»åŠ ä½ çš„æ‰€æœ‰æ—¥è®°
  // å¯ä»¥ä»ŽåŽŸ diary.html å¤åˆ¶å†…å®¹
];

async function migrate() {
  try {
    await mongoose.connect(process.env.MONGODB_URI);
    console.log('âœ… æ•°æ®åº“è¿žæŽ¥æˆåŠŸ');
    
    // æ¸…ç©ºçŽ°æœ‰æ•°æ®ï¼ˆå¦‚æžœéœ€è¦ï¼‰
    // await Diary.deleteMany({});
    // console.log('å·²æ¸…ç©ºçŽ°æœ‰æ•°æ®');
    
    // æ’å…¥æ•°æ®
    const result = await Diary.insertMany(existingDiaries);
    console.log(`âœ… æˆåŠŸè¿ç§» ${result.length} æ¡æ—¥è®°ï¼`);
    
    process.exit(0);
  } catch (err) {
    console.error('âŒ è¿ç§»å¤±è´¥:', err);
    process.exit(1);
  }
}

migrate();
```

### 2. è¿è¡Œè¿ç§»

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/fxHook.io/backend
node migrate.js
```

çœ‹åˆ° "âœ… æˆåŠŸè¿ç§» XX æ¡æ—¥è®°ï¼" è¡¨ç¤ºæˆåŠŸ

---

## å…«ã€æµ‹è¯•ç³»ç»Ÿ

### 1. æµ‹è¯•åŽç«¯API

åœ¨å®å¡”ç»ˆç«¯æˆ–æµè§ˆå™¨æµ‹è¯•ï¼š

```bash
# å¥åº·æ£€æŸ¥
curl https://api.fxhook.cn/api/health

# èŽ·å–æ—¥è®°åˆ—è¡¨
curl https://api.fxhook.cn/api/diaries
```

### 2. æµ‹è¯•å‰ç«¯

æµè§ˆå™¨è®¿é—®ï¼š

- **æ—¥è®°é¡µé¢**ï¼š`https://fxhook.cn/pages/diary.html`
- **ç®¡ç†åŽå°**ï¼š`https://fxhook.cn/pages/diary-admin.html`

### 3. æµ‹è¯•ç®¡ç†åŠŸèƒ½

1. è®¿é—®ç®¡ç†åŽå°
2. ä½¿ç”¨ `.env` ä¸­è®¾ç½®çš„å¯†ç ç™»å½•
3. å°è¯•åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ—¥è®°

---

## ä¹ã€å®å¡”é¢æ¿å¸¸ç”¨æ“ä½œ

### 1. æŸ¥çœ‹Node.jsæ—¥å¿—

**è½¯ä»¶å•†åº—** â†’ **PM2ç®¡ç†å™¨** â†’ ç‚¹å‡»é¡¹ç›®å â†’ **æ—¥å¿—**

### 2. é‡å¯Node.jsæœåŠ¡

**PM2ç®¡ç†å™¨** â†’ æ‰¾åˆ°é¡¹ç›® â†’ ç‚¹å‡» **é‡å¯**

æˆ–ç»ˆç«¯ï¼š
```bash
pm2 restart fxhook-diary
```

### 3. æŸ¥çœ‹MongoDBçŠ¶æ€

**è½¯ä»¶å•†åº—** â†’ **å·²å®‰è£…** â†’ æ‰¾åˆ°MongoDB â†’ ç‚¹å‡» **è®¾ç½®** â†’ **æœåŠ¡**

### 4. å¤‡ä»½æ•°æ®åº“

#### æ–¹æ³•Aï¼šä½¿ç”¨å®å¡”è®¡åˆ’ä»»åŠ¡

1. **è®¡åˆ’ä»»åŠ¡** â†’ **æ·»åŠ è®¡åˆ’ä»»åŠ¡**
2. **ä»»åŠ¡ç±»åž‹**ï¼šShellè„šæœ¬
3. **ä»»åŠ¡åç§°**ï¼šå¤‡ä»½MongoDB
4. **æ‰§è¡Œå‘¨æœŸ**ï¼šæ¯å¤©å‡Œæ™¨3ç‚¹
5. **è„šæœ¬å†…å®¹**ï¼š

```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/www/backup/mongodb"
mkdir -p $BACKUP_DIR

mongodump --db=fxhook_diary --out=$BACKUP_DIR/backup_$DATE

# åªä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -type d -mtime +7 -exec rm -rf {} \;
```

#### æ–¹æ³•Bï¼šæ‰‹åŠ¨å¤‡ä»½

```bash
# å¤‡ä»½
mongodump --db=fxhook_diary --out=/www/backup/mongodb/backup_$(date +%Y%m%d)

# æ¢å¤
mongorestore --db=fxhook_diary /www/backup/mongodb/backup_20260130/fxhook_diary/
```

### 5. é˜²ç«å¢™è®¾ç½®

1. **å®‰å…¨** â†’ **é˜²ç«å¢™**
2. ç¡®ä¿å¼€æ”¾çš„ç«¯å£ï¼š
   - 80ï¼ˆHTTPï¼‰
   - 443ï¼ˆHTTPSï¼‰
   - 8888ï¼ˆå®å¡”é¢æ¿ï¼‰
   - 22ï¼ˆSSHï¼‰
3. **ä¸è¦**å¼€æ”¾3000ç«¯å£ï¼ˆNode.jsé€šè¿‡Nginxä»£ç†è®¿é—®ï¼‰
4. **ä¸è¦**å¼€æ”¾27017ç«¯å£ï¼ˆMongoDBä»…æœ¬åœ°è®¿é—®ï¼‰

---

## åã€å®‰å…¨åŠ å›º

### 1. ä¿®æ”¹å®å¡”é¢æ¿ç«¯å£

**é¢æ¿è®¾ç½®** â†’ **é¢æ¿ç«¯å£** â†’ æ”¹ä¸ºè‡ªå®šä¹‰ç«¯å£ï¼ˆå¦‚ `18888`ï¼‰

### 2. å¼€å¯å®å¡”é¢æ¿BasicAuth

**é¢æ¿è®¾ç½®** â†’ **å®‰å…¨è®¾ç½®** â†’ å¼€å¯ **BasicAuthè®¤è¯**

### 3. è®¾ç½®IPç™½åå•ï¼ˆå¯é€‰ï¼‰

**é¢æ¿è®¾ç½®** â†’ **æŽˆæƒIP** â†’ æ·»åŠ ä½ çš„å¸¸ç”¨IP

### 4. ä¿®æ”¹SSHç«¯å£

**å®‰å…¨** â†’ **SSH** â†’ ä¿®æ”¹SSHç«¯å£ï¼ˆå»ºè®®éžé»˜è®¤22ç«¯å£ï¼‰

### 5. å¼€å¯IPé™æµï¼ˆé˜²DDoSï¼‰

**å®‰å…¨** â†’ **ç³»ç»ŸåŠ å›º** â†’ å¼€å¯ç›¸å…³ä¿æŠ¤

---

## åä¸€ã€å¸¸è§é—®é¢˜

### Q1: PM2ç®¡ç†å™¨æ‰¾ä¸åˆ°/å®‰è£…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ‰‹åŠ¨å®‰è£…PM2
npm install -g pm2

# ç„¶åŽåœ¨å®å¡”é¢æ¿é‡æ–°æ‰«æ
```

### Q2: MongoDBå¯åŠ¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f /data/mongodb/logs/mongodb.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tuln | grep 27017

# é‡å¯MongoDB
systemctl restart mongodb
```

### Q3: åå‘ä»£ç†504é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥Node.jsæœåŠ¡æ˜¯å¦è¿è¡Œï¼š`pm2 status`
2. æŸ¥çœ‹Node.jsæ—¥å¿—ï¼š`pm2 logs fxhook-diary`
3. æ£€æŸ¥ç«¯å£3000æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tuln | grep 3000`

### Q4: CORSè·¨åŸŸé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `.env` ä¸­çš„ `ALLOWED_ORIGINS` æ˜¯å¦åŒ…å«ä½ çš„å‰ç«¯åŸŸå
2. ç¡®ä¿å‰ç«¯åŸŸåå’Œå®žé™…è®¿é—®åŸŸåå®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬http/httpsï¼‰
3. é‡å¯Node.jsæœåŠ¡ï¼š`pm2 restart fxhook-diary`

### Q5: APIè¯·æ±‚è¿”å›ž404

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `diaryAPI.js` ä¸­çš„ `API_BASE_URL` æ˜¯å¦æ­£ç¡®
2. ç¡®ä¿åå‘ä»£ç†é…ç½®æ­£ç¡®
3. æµ‹è¯•ç›´æŽ¥è®¿é—®ï¼š`curl http://localhost:3000/api/health`

---

## åäºŒã€æ€§èƒ½ä¼˜åŒ–

### 1. å¼€å¯Nginxç¼“å­˜

åœ¨ç½‘ç«™è®¾ç½® â†’ **é…ç½®æ–‡ä»¶** ä¸­æ·»åŠ ï¼š

```nginx
# åœ¨serverå—ä¸­æ·»åŠ 
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 30d;
    access_log off;
}
```

### 2. å¼€å¯GzipåŽ‹ç¼©

Nginxé»˜è®¤å·²å¼€å¯ï¼Œå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ç¡®è®¤ï¼š

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml;
```

### 3. PM2é›†ç¾¤æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

å¦‚æžœæœåŠ¡å™¨CPUæ ¸å¿ƒæ•°è¾ƒå¤šï¼š

```bash
pm2 delete fxhook-diary
pm2 start server.js -i max --name fxhook-diary
pm2 save
```

---

## åä¸‰ã€ç»´æŠ¤æ¸…å•

### æ¯å¤©
- [ ] æŸ¥çœ‹PM2æ—¥å¿—ï¼Œç¡®è®¤æ— å¼‚å¸¸é”™è¯¯
- [ ] æ£€æŸ¥MongoDBæœåŠ¡çŠ¶æ€

### æ¯å‘¨
- [ ] æŸ¥çœ‹æœåŠ¡å™¨ç£ç›˜ç©ºé—´
- [ ] æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ˜¯å¦æ­£å¸¸ç”Ÿæˆ

### æ¯æœˆ
- [ ] æ›´æ–°ç³»ç»ŸåŒ…ï¼š`apt update && apt upgrade`
- [ ] æ£€æŸ¥å®å¡”é¢æ¿æ›´æ–°
- [ ] å®¡æŸ¥è®¿é—®æ—¥å¿—

---

## å®Œæˆï¼ðŸŽ‰

ä½ çš„æ—¥è®°ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²åœ¨å®å¡”é¢æ¿ä¸Šï¼

**è®¿é—®åœ°å€**ï¼š
- å‰ç«¯ï¼š`https://fxhook.cn/pages/diary.html`
- ç®¡ç†åŽå°ï¼š`https://fxhook.cn/pages/diary-admin.html`
- APIï¼š`https://api.fxhook.cn/api`

**é»˜è®¤ç®¡ç†å‘˜å¯†ç **ï¼šåœ¨ `.env` æ–‡ä»¶ä¸­è®¾ç½®çš„ `ADMIN_PASSWORD`

---

æœ‰é—®é¢˜æ¬¢è¿ŽæŸ¥çœ‹å®å¡”é¢æ¿çš„é”™è¯¯æ—¥å¿—æˆ–PM2æ—¥å¿—è¿›è¡ŒæŽ’æŸ¥ï¼
